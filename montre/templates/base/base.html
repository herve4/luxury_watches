{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Montres de Luxe - L'Art du Temps{% endblock %}</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="{% static 'css/output.css' %}">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.6" integrity="sha384-FhXw7b6AlE/jyjlZH5iHa/tTe9EpJ1Y55RjcgPbjeWMskSxZt1v9qkxLJWNJaGni" crossorigin="anonymous"></script>
    

    <!-- AlpineJS -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.5/dist/cdn.min.js" defer></script>
    <script>
        // Vérification du chargement d'Alpine.js
        document.addEventListener('alpine:init', () => {
            console.log('Alpine.js est correctement initialisé');
        });
        
        // Gestion des erreurs globales
        window.addEventListener('error', function(e) {
            // Vérifier si l'erreur est un objet Error
            if (e instanceof Error) {
                console.error('Erreur JavaScript:', e);
            } else if (e.message) {
                console.error('Erreur:', e.message, 'dans', e.filename, 'ligne', e.lineno);
            } else {
                console.error('Erreur inconnue:', e);
            }
            // Empêcher la propagation de l'événement d'erreur
            e.preventDefault();
            e.stopPropagation();
            return false;
        });

        // Gestion des promesses non attrapées
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Erreur de promesse non gérée:', e.reason);
            e.preventDefault();
        });
    </script>
    
    <style>
        /* Style pour masquer les éléments Alpine.js pendant le chargement */
        [x-cloak] { display: none !important; }
        
        .font-playfair { font-family: 'Playfair Display', serif; }
        .font-inter { font-family: 'Inter', sans-serif; }
        
        .gold-gradient {
            background: linear-gradient(135deg, #D4AF37 0%, #F7EF8A 100%);
        }
        
        .section-fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s ease;
        }
        
        .section-visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="bg-black text-white font-inter" data-is-authenticated="{% if user.is_authenticated %}true{% else %}false{% endif %}">
    {% include 'includes/header.html' %}
    
    <main>
        <!-- Modal Container -->
        <div id="configuration-modal" class="hidden"></div>
        {% include 'base/msg_flottant.html' %}
        {% block content %}
        {% endblock %}
    </main>
    
    
    
    <script>
        // Gestion de la fermeture des modales
        document.addEventListener('click', function(e) {
            if (e.target.closest('.close-modal')) {
                e.target.closest('.fixed').remove();
            }
        });

        // Gestion des modals HTMX
        document.addEventListener('htmx:afterSwap', function(event) {
            if (event.detail.target.id === 'configuration-modal') {
                event.detail.target.classList.remove('hidden');
            }
        });

        // Gestion des erreurs HTMX
        document.addEventListener('htmx:responseError', function(event) {
            console.error('HTMX Error:', event.detail);
            showErrorMessage('Une erreur est survenue. Veuillez réessayer.');
        });
    </script>
    
    
    <!-- Scripts d'animation -->
    <script>
        // Animation au scroll
        document.addEventListener('DOMContentLoaded', function() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('section-visible');
                    }
                });
            }, { threshold: 0.1 });
            
            document.querySelectorAll('.section-fade-in').forEach((section) => {
                observer.observe(section);
            });
        });
    </script>

    <!-- Debug HTMX -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Log tous les événements HTMX
    document.body.addEventListener('htmx:beforeRequest', function(evt) {
        console.log('HTMX Before Request:', evt.detail);
    });
    
    document.body.addEventListener('htmx:responseError', function(evt) {
        console.error('HTMX Response Error:', evt.detail);
        console.error('XHR response:', evt.detail.xhr.responseText);
        
        // Afficher un message d'erreur utilisateur
        showErrorMessage('Une erreur est survenue. Veuillez réessayer.');
    });
    
    document.body.addEventListener('htmx:afterRequest', function(evt) {
        console.log('HTMX After Request:', evt.detail);
    });
});

function showToastMessage(message, type = 'error') {
    // Créer un message flottant avec un style différent selon le type
    const toast = document.createElement('div');
    const bgColor = type === 'success' ? 'bg-green-600' : 'bg-red-600';
    const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
    
    toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${bgColor} text-white transform transition-all duration-300 translate-x-full opacity-0`;
    toast.innerHTML = `
        <div class="flex items-center">
            <i class="fas ${icon} mr-2"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(toast);
    
    // Animation d'entrée
    requestAnimationFrame(() => {
        setTimeout(() => {
            toast.classList.remove('translate-x-full', 'opacity-0');
            toast.classList.add('translate-x-0', 'opacity-100');
            
            // Supprimer le message après 5 secondes avec animation de sortie
            setTimeout(() => {
                toast.classList.remove('translate-x-0', 'opacity-100');
                toast.classList.add('translate-x-full', 'opacity-0');
                
                // Supprimer l'élément après l'animation
                setTimeout(() => {
                    toast.remove();
                }, 300);
            }, 5000);
        }, 100);
    });
}
</script>


    
    {% block extra_scripts %}{% endblock %}
    
    {% include 'includes/footer.html' %}
</body>
</html>